<!DOCTYPE html> <!--recognizes file type as HTML-->

<html lang="en"> <!--sets language to english-->

<head>
    <meta charset="UTF-8" /> <!--tells web browser to interpret doc using UTF-8 encoding-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <!--allows for mobile compatibility-->
    <title>Admin Dashboard</title> <!--Title shown in browser tab-->
    <script src="https://cdn.tailwindcss.com"></script> <!--loads tailwind for styling-->
</head>

<body class="bg-gray-400 min-h-screen p-6">
    <div class="max-w-4xl mx-auto bg-white shadow-md rounded-lg p-6">
    
    <h1 class="text-3xl font-bold text-black mb-4 text-center">RSVP Submissions</h1>

    <!--Table for RSVP data-->

    <div class="overflow-x-auto">
      <table class="min-w-full table-auto border">
        <thead>
          <tr>
            <th class="border border-black px-4 py-2 bg-blue-300">Name</th>
            <th class="border border-black px-4 py-2 bg-blue-300">Email</th>
            <th class="border border-black px-4 py-2 bg-blue-300">ID</th>
            <th class="border border-black px-4 py-2 bg-blue-300">Guests</th>
            <th class="border border-black px-4 py-2 bg-blue-300">Time</th>
          </tr>
        </thead>
        <tbody id="tableData" class="text-sm"></tbody>
      </table>
    </div>

    <!--Export Button-->

    <div class="text-center mt-6">
        <button onclick="exportCSV()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Export CSV
        </button>
    </div>

    </div>

<script>
    function loadRSVPs() {
        const tableBody = document.getElementById("tableData");
        tableBody.innerHTML = "";

        // Retrieve RSVP data

        let rawData = localStorage.getItem("qrData");
        if (!rawData) return;
        let data = JSON.parse(rawData);

        // Add row to table for each entry

        const row = `
            <tr>
            <td class="border border-black px-4 py-2">${data.fname} ${data.lname}</td>
            <td class="border border-black px-4 py-2">${data.email}</td>
            <td class="border border-black px-4 py-2">${data.hofstraId}</td>
            <td class="border border-black px-4 py-2">
                ${data.guest1fname ? data.guest1fname + ' ' + data.guest1lname : ""}
                ${data.guest2fname ? '<br>' + data.guest2fname + ' ' + data.guest2lname : ""}
            </td>
            <td class="border border-black px-4 py-2">${data.time}</td>
            </tr>`;
        tableBody.innerHTML += row;
    }

    // export table as .csv

    function exportCSV() {
        let csv = "Name,Email,ID,Guest 1,Guest 2\n";
        let data = JSON.parse(localStorage.getItem("qrData"));

        if (!data) {
            return;
        }
        
        csv += `${data.fname} ${data.lname},${data.email},${data.hofstraId},${data.guest1fname} ${data.guest1lname},${data.guest2fname} ${data.guest2lname}\n`;

        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');

        const now = new Date();
        const date = now.toISOString().split("T")[0]; 

        a.href = url;
        a.download = `rsvp_data-${date}.csv`;
        a.click();
    }

    window.onload = loadRSVPs;  // Load data on page load
  </script>

</body>
</html>