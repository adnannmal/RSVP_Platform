<!DOCTYPE html> <!--recognizes file type as HTML-->

<html lang="en"> <!--sets language to english-->

<head>
    <meta charset="UTF-8" /> <!--tells web browser to interpret doc using UTF-8 encoding-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <!--allows for mobile compatibility-->
    <title>Admin Dashboard</title> <!--Title shown in browser tab-->
    <link rel="icon" type="image/png" href="Images/logo.png" /> <!-- Tab icon -->
    <script src="https://cdn.tailwindcss.com"></script> <!--loads tailwind for styling-->
</head>

<body class="bg-gray-400 min-h-screen p-6">
  <div class="max-w-4xl mx-auto bg-white shadow-md rounded-lg p-6">

    <h1 class="text-3xl font-bold text-black mb-4 text-center">RSVP Submissions
    </h1>

    <!--Table for RSVP data-->

    <div class="overflow-x-auto">
      <table class="min-w-full table-auto border">
            <thead>
                <tr>
                    <th scope="col" class="border px-4 py-2 bg-blue-300">Name</th>
                    <th scope="col" class="border px-4 py-2 bg-blue-300">Email</th>
                    <th scope="col" class="border px-4 py-2 bg-blue-300">ID</th>
                    <th scope="col" class="border px-4 py-2 bg-blue-300">Guests</th>
                    <th scope="col" class="border px-4 py-2 bg-blue-300">Time</th>
                </tr>
            </thead>
        <tbody id="tableData" class="text-sm"></tbody>
      </table>
    </div>

    <!--Export Button-->

    <div class="flex justify-center mt-6 space-x-4">
        <button id="exportBtn" type="button" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Export CSV
        </button>
    </div>
    
    <!--Clear Entries Button-->

    <button id="clearBtn" type="button" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Clear All Entries
    </button>

    </div>

    <script>
        // Backend Start
        const API_BASE = "https://rsvp-backend-mb2j.onrender.com"; // Server PORT;

        async function loadRSVPs() {
            const resp = await fetch(`${API_BASE}/rsvps`);
            const list = await resp.json();
            const tbody = document.getElementById("tableData");
            tbody.innerHTML = "";

            if (!list.length) {
                tbody.innerHTML = `<tr><td colspan="5" class="text-center italic">No RSVPs yet.</td></tr>`;
                return;
            }

            list.forEach(r => {
                const guests = [r.guest1fname, r.guest1lname, r.guest2fname, r.guest2lname].filter(Boolean).join(" ");
                tbody.innerHTML += `
                <tr>
                    <td class="border px-4 py-2">${r.fname} ${r.lname}</td>
                    <td class="border px-4 py-2">${r.email}</td>
                    <td class="border px-4 py-2">${r.hofstraId}</td>
                    <td class="border px-4 py-2">${guests}</td>
                    <td class="border px-4 py-2">${r.submitTime}</td>
                </tr>`;
            });
        }

        document.getElementById("exportBtn").addEventListener("click", () => {
            window.location.href = `${API_BASE}/export.csv`;
        });

        document.getElementById("clearBtn").addEventListener("click", async () => {
            if (!confirm("Clear ALL RSVPs?")) {
                return;
            }

            await fetch(`${API_BASE}/rsvps`, { method: "DELETE" });
            loadRSVPs();
        });

        window.addEventListener("DOMContentLoaded", loadRSVPs);
    </script>
</body>
</html>