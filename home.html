<!DOCTYPE html> <!--recognizes file type as HTML-->

<html lang="en"> <!--sets language to english-->

<head>
    <meta charset="UTF-8" /> <!--tells web browser to interpret doc using UTF-8 encoding-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <!--allows for mobile compatibility-->
    <title>PSA RSVP Form</title> <!--Title shown in browser tab-->
    <link rel="icon" type="image/png" href="Images/logo.png" /> <!-- Tab icon -->
    <script src="https://cdn.tailwindcss.com"></script> <!--loads tailwind for styling-->
    <!--Fade in animation-->
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-fade-in {
            animation: fadeIn 0.8s ease-out forwards;
        }
    </style>
</head>

<!--flag pictures-->

<img src="Images/pakistan_flag.png" alt="rightFlag" class="fixed top-5 right-11 w-32 transform rotate-12 opacity-90 pointer-events-none" />
<img src="Images/pakistan_flag.png" alt="leftFlag" class="fixed top-5 left-11 w-32 transform -rotate-12 opacity-90 pointer-events-none" />

<!--full screen layout with green background and centered content--> 

<body class="bg-gradient-to-br from-green-100 via-white to-green-200 min-h-screen flex items-center justify-center p-4" 
    style="background: radial-gradient(circle at top left, #34d399, transparent 40%), radial-gradient(circle at bottom right, #34d399, transparent 40%), radial-gradient(circle at top right, #34d399, transparent 40%),  radial-gradient(circle at bottom left, #34d399, transparent 40%)">
    
    <div class="relative z-10 bg-white shadow-xl rounded-lg p-4 w-full max-w-md animate-fade-in"> <!--white container with shadow and padding-->
        <h1 class="text-3xl font-extrabold mb-6 text-center text-green-700">PSA Event RSVP <!--main heading-->
        </h1>

        <!--Countdown Timer for Form Submission-->

        <div id="countdown" class="text-center text-md font-semibold text-black-700 my-4">
        </div>

        <!--RSVP Form-->

        <form id="rsvpForm" class="space-y-4">
            <label class="block "> <!--Input for first name-->
                <span class="text-gray-700">First Name 
                </span>
            <input type="text" id="fname" name="fname" placeholder="First Name" required class="w-full border p-2  mt-2 rounded focus:outline-none focus:ring-2 focus:ring-green-400 transition-transform duration-300 focus:scale-105" />

            <label class="block mt-2"> <!--Input for last name-->
                <span class="text-gray-700">Last Name 
                </span>
            <input type="text" id="lname" name="lname" placeholder="Last Name" required class="w-full border p-2 mt-2 rounded focus:outline-none focus:ring-2 focus:ring-green-400 transition-transform duration-300 focus:scale-105" /> <!--Input for last name-->

            <label class="block mt-2"> <!--Input for ID#-->
                <span class="text-gray-700">Hofstra ID
                </span>
            <input type="text" id="hofstraId" name="hofstraId" placeholder="h123456789" pattern="^h\d{9}$" required class="w-full border p-2 mt-2 rounded focus:outline-none focus:ring-2 focus:ring-green-400 transition-transform duration-300 focus:scale-105" /> <!--Optional Input for hofstra ID-->
            
            <label class="block mt-2"> <!--Input email-->
                <span class="text-gray-700">Email Address
                </span>
            <input type="email" id="email" name="email" required placeholder="@pride.hofstra.edu" pattern=".+@pride\.hofstra\.edu" class="w-full border p-2 mt-2 rounded focus:outline-none focus:ring-2 focus:ring-green-400 transition-transform duration-300 focus:scale-105" />
            
            <!--Guest Dropdown-->

            <label class="block mt-2 mb-2">
                <span class="text-gray-700">Are you bringing guests?
                </span>
            <select name="status" id="statusSelect" required class="w-full border p-2 mt-2 rounded focus:outline-none focus:ring-2 focus:ring-green-400 transition"> <!--Dropdown menu to select student or guest-->
                <option value="student">No</option>
                <option value="guest">Yes</option>
            </select>
            </label>

            <div id="guestField" class="block hidden">

                <!-- Guest 1 Required-->
                
                <label class="block mt-3"> <!--Input for Guest 1 first name-->
                    <span class="text-gray-700">Guest 1:
                    </span>
                <input type="text" id="guest1fname" name="guest1fname" placeholder="First Name" class="w-full border p-2  mt-1 rounded focus:outline-none focus:ring-2 focus:ring-green-400 transition-transform duration-300 focus:scale-105" />

                <label class="block "> <!--Input for Guest 1 last name-->
                    <span class="text-gray-700">
                    </span>
                <input type="text" id="guest1lname" name="guest1lname" placeholder="Last Name" class="w-full border p-2  mt-2 rounded focus:outline-none focus:ring-2 focus:ring-green-400 transition-transform duration-300 focus:scale-105" />

                <!-- Guest 2 Optional-->
                
                <label class="block mt-3"> <!--Input for Guest 2 first name -->
                    <span class="text-gray-700">Guest 2 (optional):
                    </span>
                <input type="text" id="guest2fname" name="guest2fname"placeholder="First Name" class="w-full border p-2  mt-1 rounded focus:outline-none focus:ring-2 focus:ring-green-400 transition-transform duration-300 focus:scale-105" />

                <label class="block "> <!--Input for Guest 2 last name-->
                    <span class="text-gray-700">
                    </span>
                <input type="text" id="guest2lname" name="guest2lname" placeholder="Last Name" class="w-full border p-2  mt-2 rounded focus:outline-none focus:ring-2 focus:ring-green-400 transition-transform duration-300 focus:scale-105" />
            </div>

            <!-- Submit Button -->

            <div>
                <button id="submitBtn" type="submit" class="bg-green-600 text-white px-4 py-2 mt-4 rounded hover:bg-blue-700 w-full">Submit RSVP
                </button>
            </div>
        </form>
    </div>
            
    <!--Contact Info-->

    <div id="contactPage" class="fixed inset-0 bg-black bg-opacity-50 flex items-center hidden justify-center z-10">
        <div class="bg-white p-6 rounded shadow-lg w-80 text-center relative">
            <button onclick="closePage()" class="absolute top-2 right-3 text-gray-600 text-xl">&times;</button> <!--X Button-->
            <h2 class="text-lg font-semibold mb-2">Contact Us</h2>
            <img src="Images/email.jpg" alt="Email" class="w-7 h-7 inline-block" />
            Email: <a href="mailto:hofstrapsa@gmail.com" class="text-blue-600 hover:underline">hofstrapsa@gmail.com</a></p>
            <img src="Images/insta.jpg" alt="Instagram" class="w-6 h-6 inline-block" />
            Instagram: <a href="https://instagram.com/hofstrapsa" target="_blank" class="text-blue-600 hover:underline">@hofstrapsa</a></p> 
        </div>
    </div>

    <!--Contact Button at bottom of page-->

    <div class="fixed bottom-0 right-0 z-10">

        <!--Contact Button-->

        <button onclick="openPage()" type="button" class="text-sm text-blue-700 underline hover:text-blue-900 ">
        <img src="Images/question_mark.png" alt="question" class="w-12 h-12 inline-block" />
        </button>
    </div>


    <script>
        // form expiration (hide submit button)

        const dateNow = new Date();
        const formExpire = new Date("2025-10-01T01:00:00Z");

        if (dateNow > formExpire) {
            const submitBtn = document.getElementById('submitBtn')
            submitBtn.classList.add("hidden");
        }

        // script for guest selection

        document.getElementById("statusSelect").addEventListener("change", function () {
            const selected = this.value; // get value from dropdown entry
            const guestField = document.getElementById("guestField"); // reference to submitted form

            // input fields for guest names

            const guest1fname = document.getElementById("guest1fname");
            const guest1lname = document.getElementById("guest1lname");
            const guest2fname = document.getElementById("guest2fname");
            const guest2lname = document.getElementById("guest2lname");

            if (selected === "guest") { // if yes show guest fields and make guest 1 required
                guestField.classList.remove("hidden");
                guest1fname.required = true;
                guest1lname.required = true;
                guest2fname.required = false;
                guest2lname.required = false;
            } 
            else { // else all entry is hidden and requirement is removed
                guestField.classList.add("hidden");
                guest1fname.required = false;
                guest1lname.required = false;
                guest2fname.required = false;
                guest2lname.required = false;
            }
        
        });

        // listens for form submission

        document.getElementById("rsvpForm").addEventListener("submit", async (e) => {
            e.preventDefault(); // prevents page to reload

            const form = e.target;

            // validate manually to prevent "not focusable" error

            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            /*

            // QR code expiration after event

            const qrExpire = new Date("2025-10-01T00:00:00Z").toISOString(); // date qr code expires

            // time submitted

            const submitTime = new Date().toLocaleString("en-US", {
                year: "numeric",
                month: "long",
                day: "numeric",
                hour: "numeric",
                minute: "2-digit"
            });

            console.log(submitTime); // log time submitted

            */

            // collect data from form to objects

            const data = {
                fname: form.fname.value.trim(),
                lname: form.lname.value.trim(),
                email: form.email.value.trim(),
                hofstraId: form.hofstraId.value.trim(),
                status: form.status.value,
                guest1fname: form.guest1fname.value.trim() || "",
                guest1lname: form.guest1lname.value.trim() || "",
                guest2fname: form.guest2fname.value.trim() || "",
                guest2lname: form.guest2lname.value.trim() || "",
                qrExpire: new Date("2025-08-01T00:00:00Z").toISOString(),
            };

            try {
                const resp = await fetch(`${API_BASE}/submit`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
                });

                const json = await resp.json();

                if (!resp.ok || !json.success) {
                alert(json.error || "Submission failed");
                return;
                }

                // Save server-issued id (ticket id) for success page
                localStorage.setItem("ticketId", json.id);
                window.location.href = "success.html";
            } 
            catch (err) {
                console.error(err);
                alert("Network error.");
            }
        });

        function openPage() { // open contact page
            document.getElementById("contactPage").classList.remove("hidden");
        }

        function closePage() { // close contact page
            document.getElementById("contactPage").classList.add("hidden");
        }

        const event = new Date("2025-10-01T00:00:00Z").getTime(); // set event time

        const countdown = document.getElementById("countdown");

        const countdownTimer = setInterval(() => { // run every second to update timer
            const now = new Date().getTime(); // current time
            const timeLeft = event - now; // time left

            if (timeLeft <= 0) {
                countdown.style.display = "none"; // hide countdown
            }

            // define days, hours, minutes, seconds

            const days = Math.floor(timeLeft / (1000 * 60 *60 * 24));
            const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const mins = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
            const secs = Math.floor((timeLeft % (1000 * 60)) / 1000);

            // change color corresponding to how close the day is to day of event

            let color = "text-black-700"; // default color
            if (timeLeft < 1000 * 60 * 60 * 24 * 3) { // less than 3 days
                color = "text-orange-500";
            }
            if (timeLeft < 1000 * 60 * 60 * 12) { // less than 12 hours
                color = "text-yellow-500";
            }
            if (timeLeft < 1000 * 60 * 60 * 1) { // less than 1 hours
                color = "text-red-600";
            }

            countdown.className = `text-center text-lg font-semibold ${color} my-4`; // apply color
            countdown.innerHTML = `⏳ ${days}d ${hours}h ${mins}m ${secs}s left`; // timer text + update

        }, 1000); // update every second
    </script>

</body>
</html>